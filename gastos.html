<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gastos y Pagos</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="./css/gastos.css">
</head>

<body>
    <div id="app">
        <div class="Titulo">
            <h1>Gastos y sus Pagos</h1>
        </div>
        <div class="informacion">
            <div class="panel">
                <p>espacio para los filtros y menúes</p>
                <div>
                    <label for="filtroMotivo">Filtrar por Motivo:</label>
                    <select v-model="filtroMotivo" id="filtroMotivo">
                        <option value="">Todos</option>
                        <option v-for="motivo in motivosGasto" :key="motivo.idMotivo" :value="motivo.descripcion">{{ motivo.descripcion }}</option>
                    </select>
                </div>
                <div>
                    <label for="filtroFechaDesde">Filtrar por Fecha Desde:</label>
                    <input type="date" v-model="filtroFechaDesde" id="filtroFechaDesde">
                </div>
                <div>
                    <label for="filtroFechaHasta">Filtrar por Fecha Hasta:</label>
                    <input type="date" v-model="filtroFechaHasta" id="filtroFechaHasta">
                </div>
                <button @click="filtroPagos = filtroPagos === 0 ? 1 : 0; if (filtroPagado === 0 && filtroPagos === 1) filtroPagado = 2;">
                    {{ filtroPagos === 0 ? 'Mostrar Pagos' : 'Ocultar Pagos' }}
                </button>
                <button @click="filtroPagado = (filtroPagado + 1) % 3">
                    Mostrar: {{ filtroPagado === 0 ? 'No Pagados' : filtroPagado === 1 ? 'Pagados' : 'Todos' }}
                </button>
                <button @click="resetFiltros">Reset</button> <!-- Botón Reset -->
                <button @click="mostrarFormulario = !mostrarFormulario">Nuevo Gasto</button> <!-- Botón Nuevo Gasto -->
            </div>
            <div v-if="mostrarFormulario" class="formulario">
                <h2>Nuevo Gasto</h2>
                <form @submit.prevent="crearGasto">
                    <div>
                        <label for="motivo">Motivo:</label>
                        <select v-model="nuevoGasto.motivo" required>
                            <option v-for="motivo in motivosGasto" :key="motivo.idMotivo" :value="motivo.idMotivo">{{ motivo.descripcion }}</option>
                        </select>
                    </div>
                    <div>
                        <label for="importe">Importe:</label>
                        <input type="number" v-model="nuevoGasto.importe" required>
                    </div>
                    <div>
                        <label for="fecha_gasto">Fecha del Gasto:</label>
                        <input type="date" v-model="nuevoGasto.fecha_gasto" required>
                    </div>
                    <div>
                        <label for="observaciones">Observaciones:</label>
                        <textarea v-model="nuevoGasto.observaciones"></textarea>
                    </div>
                    <button type="submit">Guardar</button>
                    <button type="button" @click="mostrarFormulario = false">Cancelar</button>
                </form>
            </div>
            <div class="tablas">
                <table border="1" width="auto">
                    <thead>
                        <tr>
                            <th>ID Gasto</th>
                            <th>Motivo</th>
                            <th>Importe</th>
                            <th>Fecha Gasto</th>
                            <th>Fecha Pago</th>
                            <th>Pagado</th>
                            <th>Saldo</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template v-for="gasto in filtrarGastos" :key="gasto.idGasto">
                            <tr v-if="filtroPagado === 2 || (filtroPagado === 1 && gasto.pagado) || (filtroPagado === 0 && !gasto.pagado)">
                                <td>{{ gasto.idGasto }}</td>
                                <td>{{ gasto.motivoDescripcion }}</td>
                                <td>{{ gasto.importe }}</td>
                                <td>{{ gasto.fecha_gasto }}</td>
                                <td>{{ gasto.fecha_pago }}</td>
                                <td>{{ gasto.pagado ? 'Si' : 'No' }}</td>
                                <td>{{ gasto.saldo }}</td>
                                <td>{{ gasto.observaciones }}</td>
                                <td></td>
                            </tr>
                            <tr v-if="filtroPagos === 1 && pagos.some(pago => pago.idGasto === gasto.idGasto)" style="color: yellow;">
                                <td colspan="8">
                                    <table border="1" width="auto">
                                        <thead>
                                            <tr>
                                                <th>ID Pago</th>
                                                <th>IdGasto</th>
                                                <th>Fecha Pago</th>
                                                <th>Monto Pago</th>
                                                <th>Medio Pago</th>
                                                <th>Observaciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="pago in pagos.filter(p => p.idGasto === gasto.idGasto)" :key="pago.idPago">
                                                <td>{{ pago.idPago }}</td>
                                                <td>{{ pago.idGasto }}</td>
                                                <td>{{ pago.fecha_pago }}</td>
                                                <td>{{ pago.monto_pago }}</td>
                                                <td>{{ pago.idMedioPago }}</td>
                                                <td>{{ pago.observaciones }}</td>
                                            </tr>
                                            <tr v-if="pagos.filter(p => p.idGasto === gasto.idGasto).length === 0">
                                                <td colspan="4">No hay pagos para este gasto</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="./js/gastos.js"></script>
</body>

</html>
